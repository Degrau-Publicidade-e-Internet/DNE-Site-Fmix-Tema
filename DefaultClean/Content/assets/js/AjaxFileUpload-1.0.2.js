// ajax file upload
!function($){$.fn.extend({InitAjaxUpload:{IniciaUploadPlug:function(b){var a,c=function(a,b){return function(){return a.apply(b,arguments)}};return a=(function(){var b,d,u,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;function a(b,g){var i=this;this.input=b,this.upload=c(this.upload,this),this.reset=c(this.reset,this),this.settings=r.merge(h,g),(this.input.multiple||this.settings.multiple)&&(this.input.multiple=!0,this.settings.multiple=!0),null!=this.settings.droparea&&(u=$(this.settings.droparea)).length>0&&(["dragenter","dragover","dragleave","drop"].forEach(a=>{u[0].addEventListener(a,d,!1),document.body.addEventListener(a,d,!1)}),["dragenter","dragover"].forEach(a=>{u[0].addEventListener(a,highlightelement,!1)}),["dragleave","drop"].forEach(a=>{u[0].addEventListener(a,unhighlightelement,!1)}),u[0].addEventListener("drop",function(a){var b=a.dataTransfer.files;return i.files=b,o(a,i)})),["dragenter","dragover","dragleave","drop"].forEach(a=>{this.input.addEventListener(a,d,!1),document.body.addEventListener(a,d,!1)}),["dragenter","dragover"].forEach(a=>{this.input.addEventListener(a,f,!1)}),["dragleave","drop"].forEach(a=>{this.input.addEventListener(a,e,!1)}),this.input.addEventListener("drop",function(a){var b=a.dataTransfer.files;return i.files=b,o(a,i)}),this.settings.allowedTypes.length>0&&r.attr(this.input,{accept:this.settings.allowedTypes.join()}),""===this.settings.url&&(this.settings.url=this.input.getAttribute("data-url")),""===this.settings.url&&""!==this.input.form.action&&(this.settings.url=this.input.form.action),""!==this.settings.url&&(this.settings.additionalData!=={}&&(this.settings.url+="?"+r.serialize(this.settings.additionalData)),this.settings.showCustomInput&&q(this),p.fileAPI&&p.formData?this.input.addEventListener("change",function(a){return i.files=i.input.files,o(a,i)}):j(this),window.AjaxFileUpload=window.AjaxFileUpload||a,window.AjaxFileUpload.instances=a.instances||[],window.AjaxFileUpload.instances[this.input.id]=this)}return h={url:"",additionalData:{},autoUpload:!1,dataType:"json",method:"post",pathToSwf:"/dist/AjaxFileUpload.swf",contentType:"application/json; charset=utf-8",showCustomInput:!1,buttonEmptyText:"Select",buttonSelectedText:"Upload",multiple:!1,sizeLimit:0,allowedTypes:[],onSuccess:function(){},onError:function(){},onFileSelect:function(){},onProgress:function(){},onProgressStart:function(){},onProgressEnd:function(){},droparea:null},unhighlightelement=function(a){u[0].classList.remove("dg-hover")},highlightelement=function(){u[0].classList.add("dg-hover")},e=function(a){},f=function(){},d=function(a){a.preventDefault(),a.stopPropagation()},a.prototype.reset=function(){var a,b;null!=(a=document.getElementById("fu-button-"+this.input.id))&&(a.innerHTML=this.settings.buttonEmptyText),null!=(b=document.getElementById("fu-input-"+this.input.id))&&(b.value=""),this.input.value="",r.css(this.input,{display:"block"})},a.prototype.upload=function(){return b(this)},o=function(c,d){var e,f,a;a=d.settings,t(d)&&(a.autoUpload&&d.upload(),a.onFileSelect.apply(a,[c.target.files]),a.showCustomInput&&(e=document.getElementById("fu-button-"+c.target.id),f=document.getElementById("fu-input-"+c.target.id),e.innerHTML=a.buttonSelectedText,r.css(d.input,{display:"none"}),e.onclick=function(){return b(d),!1},i(f,c.target.files)))},b=function(b){var d,e,a,c,g,f;if(0!==b.files.length){for((a=new XMLHttpRequest).upload?(a.upload.addEventListener("progress",function(a){return k(a,b)}),a.upload.addEventListener("loadstart",function(a){return m(a,b)}),a.upload.addEventListener("load",function(a){return l(a,b)})):a.addEventListener("progress",function(a){return k(a,b)}),a.addEventListener("readystatechange",function(a){return n(a,b)}),e=new FormData,f=b.files,c=0,g=f.length;c<g;c++)d=f[c],e.append(d.name,d);switch(a.open(b.settings.method,b.settings.url,!0),b.settings.dataType){case"json":a.setRequestHeader("Accept","application/json");break;case"xml":a.setRequestHeader("Accept","text/xml")}a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(e)}},n=function(f,b){var c,a,d,e;4===(a=f.target).readyState&&(c=a.responseText,~a.getResponseHeader("content-type").indexOf("application/json")&&window.JSON&&(c=JSON.parse(c)),200===a.status||201===a.status?((d=b.settings).onSuccess.apply(d,[c,b.files,a]),b.reset()):(e=b.settings).onError.apply(e,[c,b.files,a]))},m=function(c,a){var b;return a.settings.showCustomInput&&(document.getElementById("fu-wrap-"+a.input.id).className+=" fu-loading"),(b=a.settings).onProgressStart.apply(b,[a.files,c.target])},k=function(a,b){var c;return(c=b.settings).onProgress.apply(c,[a.loaded,a.total,b.files,a.target])},l=function(d,a){var b,c;return a.settings.showCustomInput&&((b=document.getElementById("fu-wrap-"+a.input.id)).className=b.className.replace(" fu-loading","")),(c=a.settings).onProgressEnd.apply(c,[a.files,d.target])},j=function(a){var f,i,b,d,h,e,j,c,k,l,m;if(d="fu-embed-"+a.input.id,!document.getElementById(null!==d)){for(e in f=(f=a.settings.allowedTypes).join(";").replace(/[a-z]*\//ig,"*."),h={id:a.input.id,url:a.settings.url,method:a.settings.method,multiple:a.settings.multiple,additionalData:a.settings.additionalData,sizeLimit:a.settings.sizeLimit,allowedTypes:f},c={movie:a.settings.pathToSwf,quality:"low",play:"true",loop:"true",wmode:"transparent",scale:"noscale",menu:"true",devicefont:"false",salign:"",allowScriptAccess:"sameDomain",flashvars:r.serialize(h)},i={src:a.settings.pathToSwf,id:d,name:"fu-embed-"+a.input.id,classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",FlashVars:r.serialize(h),width:a.input.offsetWidth+5,height:a.input.offsetHeight+5},b=document.getElementById(d),b||(b=document.createElement("embed")),m=document.getElementById("fu-wrap-"+a.input.id),g(b,m),c)l=c[e],c.hasOwnProperty(e)&&(j=document.createElement("param"),r.attr(j,{name:e,value:l}));r.attr(b,r.merge(i,c)),r.css(b,{position:"absolute",top:0,left:0,opacity:0,cursor:"pointer"}),a.settings.showCustomInput?((k=document.getElementById("fu-button-"+a.input.id)).parentNode.insertBefore(b,k.nextSibling),a.input.style.display="none"):a.input.parentNode.insertBefore(b,a.input.nextSibling)}},g=function(a,b){return a.onmouseover=function(){return r.attr(b,{class:"fu-wrap fu-hover"})},a.onmouseout=function(){return r.attr(b,{class:"fu-wrap"})},a.onmousedown=function(){return r.attr(b,{class:"fu-wrap fu-active"})},a.onmouseup=function(){return r.attr(b,{class:"fu-wrap"})}},q=function(e){var c,f,a,b,d;return d="fu-wrap-"+(a=e.input).id,null===document.getElementById(d)&&(b=document.createElement("div"),r.attr(b,{class:"fu-wrap",id:d}),r.css(b,{position:"relative"}),f=document.createElement("input"),r.attr(f,{type:"text",disabled:"disabled",class:"fu-input",id:"fu-input-"+a.id}),c=document.createElement("button"),r.attr(c,{class:"fu-button button",id:"fu-button-"+a.id}),e.settings.autoUpload?c.innerHTML=e.settings.buttonSelectedText:c.innerHTML=e.settings.buttonEmptyText,c.onclick=function(){return c.innerHTML===e.settings.buttonSelectedText&&e.upload(),!1},b.appendChild(f),b.appendChild(c),a.parentNode.insertBefore(b,a.nextSibling),b.appendChild(a),r.css(a,{position:"absolute",top:0,left:0,opacity:0}),g(a,b),r.css(a,{width:document.getElementById(d).clientWidth+"px",height:document.getElementById(d).clientHeight+"px"}),a)},i=function(d,a){var c,b,e;if(0!==a.length){if(1===a.length)return d.value=a[0].name;if(a.length>1){for(b=0,c="",e=a.length;b<e;b++)c+=a[b].name+" ";return d.value=c}}},r={css:function(d,b){var a,c;for(a in b)c=b[a],d.style[a]=c},attr:function(d,b){var a,c;for(a in b)c=b[a],"class"===a?d.className=c:b.hasOwnProperty(a)&&d.setAttribute(a,c)},serialize:function(e,f){var d,a,b,c;for(a in b=[],e)c=e[a],d=f?f+"["+a+"]":a,"object"==typeof c?b.push(r.serialize(c,d)):b.push(encodeURIComponent(d)+"="+encodeURIComponent(c));return b.join("&")},merge:function(b,c){var a;for(a in c)try{c[a].constructor===Object?b[a]=r.merge(b[a],c[a]):b[a]=c[a]}catch(d){b[a]=c[a]}return b}},p={fileAPI:!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,formData:!!window.FormData,fileTypeFiltering:"string"==typeof document.createElement("input").accept,progressbar:void 0!==document.createElement("progress").max},s={sizeLimit:function(a,b){return a<=b},fileType:function(e,a){var c,b,d;if(a===[]||!p.fileTypeFiltering)return!0;if(c=!1,a)for(b=0,d=a.length;b<d;b++)~(0,a[b]).indexOf(e)&&(c=!0);return c}},t=function(d){var b,e,c,a,f,g;if(e=d.files,a=d.settings,c=[],0===e.length)return a.onError.apply(d,["No file selected"]),!1;for(f=0,g=e.length;f<g;f++)b=e[f],0===a.sizeLimit||s.sizeLimit(b.size,a.sizeLimit)||c.push('"'+b.name+'" is '+b.size+" bytes. O limite m\xe1ximo \xe9 "+a.sizeLimit+" bytes."),0===a.allowedTypes.length||s.fileType(b.type,a.allowedTypes)||c.push('"'+b.name.split(".")[1]+'" n\xe3o \xe9 um tipo / extens\xe3o de arquivo v\xe1lido: '+a.allowedTypes);return c.length>0&&a.onError.apply(d,c),0===c.length},a}).call(this),window.AjaxFileUploadFlashProxy=function(b,c,d){var a;(a=window.AjaxFileUpload.instances[b]).settings[c].apply(a,d)},window.AjaxFileUpload=a,this.each(function(d,c){new a(c,b)})}}.IniciaUploadPlug})}(jQuery);