@model DNE.Site.Models.ListaDeProdutosModel

@{

    var oModel = Model;
    string classTipo = string.Empty;
    var ULTP = "";

    ViewData["BodyID"] = "categoria-pg";
    ViewData["QtdfPags"] = oModel.PageCount;
    ViewData["compretambemCheckout"] = null;
    ViewData["Description"] = oModel.MetaTagsSeo.Seo_Description;
    ViewData["Title"] = oModel.MetaTagsSeo.Seo_Title;

    string corFaixa = "#C6E3E1";

    var textoEscuro = Model.HederCategoria.TextoEscuroFaixa ? "dg-categoria-topo-txtEscuro" : "dg-categoria-topo-txtClaro";
    corFaixa = Model.HederCategoria.CorFaixa == "#000000" ? "#C6E3E1" : @Model.HederCategoria.CorFaixa;
    corFaixa = oModel.IsBuscaNotFound ? Model.HederCategoria.CorFaixaSemResultado : corFaixa;

    var tipoPg = Model.Tipo;

    if (tipoPg == "Familia")
    {
        classTipo = "dg-familia";
        ViewData["Description"] = $"Comprar toda a linha {oModel.PalavraBusca} com melhor preço, compare os preços de {oModel.PalavraBusca} na Drogaria Nova Esperança. Comprar online com entrega em todo o Brasil. 11 3990-7720";
        ViewData["Title"] = oModel.CategoriaTitle.Trim() + " | Drogaria Nova Esperança";
    }
    if (tipoPg == "Categorias")
    {
        classTipo = "dg-categoria";
        ViewData["Description"] = $"Comprar {oModel.CategoriaTitle.Trim()} online na Drogaria Nova Esperança em até 3X sem juros. Desde 1972 promovendo saúde. Entregamos em todo o Brasil - 11 3990-7720";
        ViewData["Title"] = $"Comprar {oModel.CategoriaTitle.Trim()} online | Drogaria Nova Esperança";
    }
    var tipoPagColunas = "dg-3";

    if (Model.Tipo == "Favoritos")
    {
        tipoPagColunas = "dg-4";
    }
    if (Model.Tipo == "Pagina Ofertas")
    {
        ViewData["BodyID"] = "Pagina-Ofertas-pg";
    }

    if (tipoPg == "Busca")
    {
        ViewData["BodyID"] = "busca-pg";
    }

}

@if (@Model.QTDResultTotal == 0 && tipoPg != "Busca" && tipoPg != "Favoritos")
{
    @await Html.PartialAsync("_404")
}

else if (@Model.QTDResultTotal == 0 && tipoPg == "Favoritos")
{
    <div class="container">
        <main id="main" class="dg-categoria-semfavoritos">
            <h1 class="dg-titulo">Gostou de algum produto? Marque o como favorito e o salve aqui nesta lista! Você será notificado caso seus favoritos fiquem em promoção ou quando voltarem ao estoque.</h1>
        </main>
    </div>
}


@*Essa parte vai deixar de existir*@
else if (@Model.QTDResultTotal == 0 && tipoPg == "Busca" && Model.IsBuscaNotFound == false)
{

    <section class="dg-categoria-topo dg-categoria-topo-txtClaro" nome-categoria="" nome-tipo="Busca">
        <div class="dg-categoria-topo-wrapper" style="background-image: url(/assets/img/categoria/busca-fundo.png), linear-gradient(@Model.HederCategoria.CorFaixaSemResultado, @Model.HederCategoria.CorFaixaSemResultado)">
            <div class="container">
                <ul class="dg-categoria-breadcrumb" vocab="https://schema.org/" typeof="BreadcrumbList">
                    <li property="itemListElement" typeof="ListItem">
                        <a href="@Html.Domain()/">Home</a>
                        <meta property="position" content="1">
                        <meta property="name" content="Home">
                    </li>
                    <li property="itemListElement" typeof="ListItem">
                        <span>Busca</span>
                        <meta property="position" content="2">
                        <meta property="name" content="Busca">
                    </li>
                </ul>


                <div class="dg-categoria-intro">
                    @* Resultado busca *@
                    <div class="dg-categoria-titulo">
                        <div class="dg-categoria-titulo-img">
                            <!--TODO imagem-->
                            <img src="@Html.Domain()/assets/img/categoria/@Model.HederCategoria.ImagemCategoria" alt="@Model.HederCategoria.Alt_Imagem" title="@Model.HederCategoria.Alt_Imagem" loading="lazy">
                        </div>

                    </div>
                    <h1 class="dg-categoria-desc">
                        Sua busca por <strong>"@Html.Display("Busca")"</strong> não encontrou nenhum resultado. Faça uma nova busca ou
                        navegue pelas categorias.
                    </h1>


                </div>


            </div>
        </div>
    </section>
}

else
{
    <section class="dg-categoria-topo @textoEscuro dg-landing-banner-topo" nome-categoria="@Html.Raw(@ViewBag.Breadcrumbs_Name0)" nome-tipo="@tipoPg">
        <div class="dg-categoria-topo-wrapper" style="">
            <div class="container">
                @* BreadCrumb *@
                <ul class="dg-categoria-breadcrumb" vocab="https://schema.org/" typeof="BreadcrumbList">

                    <li property="itemListElement" typeof="ListItem" itemscope itemtype="https://schema.org/ListItem">
                        <a href="@Html.Domain()/" property="item" typeof="WebPage">
                            <span property="name">Home</span>
                        </a>
                        <meta property="position" content="1">
                        <meta property="name" content="Home">
                    </li>

                    @if (@ViewBag.Breadcrumbs_Name0.ToString().Length > 0 || ViewBag.Breadcrumbs_Name1.ToString().Length > 0)
                    {

                        <li property="itemListElement" typeof="ListItem">
                            @if (@ViewBag.Breadcrumbs_Name1.ToString().Length > 0)
                            {
                                if (tipoPg == "Marcas")
                                {
                                    <a href="@Model.UrlBreadcrumb" property="item" typeof="WebPage">
                                        <span property="name" content="@Html.Raw(@ViewBag.Breadcrumbs_Name0)">@Html.Raw(@ViewBag.Breadcrumbs_Name0)</span>
                                    </a>

                                }
                                else
                                {
                                    <a href="@Html.Domain()/@Html.Raw(@ViewBag.Breadcrumbs_Name0)/" property="item" typeof="WebPage">
                                        <span property="name" content="@Html.Raw(@ViewBag.Breadcrumbs_Name0)">@Html.Raw(@ViewBag.Breadcrumbs_Name0)</span>
                                    </a>
                                }


                            }
                            else
                            {

                                <a href="@Model.UrlBreadcrumb" property="item" typeof="WebPage">
                                    <span property="name" content="@Html.Raw(@ViewBag.Breadcrumbs_Name0)">@Html.Raw(@ViewBag.Breadcrumbs_Name0)</span>
                                </a>


                            }
                            <meta property="position" content="2">
                        </li>
                        @if (@ViewBag.Breadcrumbs_Name1.ToString().Length > 0 && tipoPg != "Marcas")
                        {
                            <li property="itemListElement" typeof="ListItem">
                                <a href="@Model.UrlBreadcrumb" property="item" typeof="WebPage">
                                    <span property="name" content="@Html.Raw(@ViewBag.Breadcrumbs_Name1)">@Html.Raw(@ViewBag.Breadcrumbs_Name1)</span>
                                </a>
                                <meta property="position" content="3">
                            </li>
                        }
                    }


                </ul>



                <div class="dg-landing-banner @classTipo">

                    @if (@oModel.HederCategoria.BannerPrincipal.Count() > 0)
                    {
                        <img src="https://static.drogarianovaesperanca.com.br/banners/dne/@oModel.HederCategoria.BannerPrincipal">
                    }
                </div>

                <div class="dg-landing-banner-fundo @classTipo">
                    @if (@oModel.HederCategoria.ImagemFundo.Count() > 0)
                    {
                        <style>
                            body {
                                background: url(https://static.drogarianovaesperanca.com.br/banners/dne/@oModel.HederCategoria.ImagemFundo) no-repeat top center fixed;
                                -webkit-background-size: cover;
                                -moz-background-size: cover;
                                -o-background-size: cover;
                                background-size: cover;
                            }
                        </style>
                    }

                </div>
            </div>
        </div>

    </section>

    @* /Topo *@

    @if ((Model.Pagina == 1 || Model.Pagina == 0) && ViewBag.TextoSeroCat.Length > 10)
    {

        <section class="dg-categoria-subtexto">
            <div class="container">
                <p>@Html.Raw(@ViewBag.TextoSeroCat)</p>
                <a href="javascript:void(0)" class="jsBtnSeoCategoriaVermais">
                    Ver mais
                </a>
            </div>
        </section>
    }
    else if ((Model.Pagina == 1 || Model.Pagina == 0) || ViewBag.TextoSeroCat.Length < 10)
    {
        <section class="dg-categoria-subtexto">
            <div class="container">
                <p>@Html.Raw(@ViewBag.TextoSeroCat)</p>
            </div>
        </section>
    }

    @* conteudo *@
    <div class="container">

        @* Menu mobile *@
        <nav class="dg-categoria-menumobile">
            <ul>
                <li>
                    <a href="javascript:void(0)" class="jsAbrirOrdenar">
                        <img src="@Html.Domain()/assets/img/lazy.png" data-src-lazy="@Html.Domain()/assets/img/categoria/ordenar.svg" role="presentation" alt="Ícone Ordenar" loading="lazy">
                        Ordenar
                    </a>
                </li>

                <li>
                    <a href="javascript:void(0)" class="jsAbrirFiltrar">
                        <img src="@Html.Domain()/assets/img/lazy.png" data-src-lazy="@Html.Domain()/assets/img/categoria/filter.svg" role="presentation" alt="Ícone SVG" loading="lazy">
                        Filtrar
                    </a>
                </li>
            </ul>
        </nav>
        @* /Menu mobile *@





        <section class="dg-categoria">

            @if (tipoPg != "Favoritos")
            {
                @* Sidebar *@
                <aside class="dg-categoria-sidebar">
                    <a href="javascript:void(0)" class="dg-categoria-sidebar-voltar jsAbrirFiltrar">
                        <span class="dg-icon dg-icon-arrow01-left"></span> Voltar
                    </a>

                    <div class="dg-categoria-sidebar-titulo">
                        Ajuste os filtros:
                    </div>

                    @await Html.PartialAsync("ListaSubcategorias")

                    @await Html.PartialAsync("ListaMarcas")

                    @await Html.PartialAsync("ListaValores")

                    @await Html.PartialAsync("ListaLetras")

                    @if (Model.mostraControlado || Model.mostraGenerico || Model.mostraRefrigerado)
                    {
                        <div class="dg-titulo">
                            Filtre por <strong>tipo</strong>:

                        </div>
                        <div class="dg-categoria-sidebar-listagem-wrapper">
                            <ul class="dg-categoria-sidebar-listagem dg-categoria-sidebar-listagem-contrgenerico">
                                @{
                                    if (Model.mostraGenerico)
                                    {
                                        <li>
                                            <a href="@Html.Display("URLGenerico")"><span class="dg-icon dg-icon-generico"></span> Genéricos</a>

                                            @if (Model.request.idgenerico != "" && Model.request.idgenerico != null)
                                            {

                                                <a href="@Html.Display("URLLimparG")" aria-label="Limpar Filtro" class="dg-categoria-sidebar-limpar dg-tooltip-hover">
                                                    <span class="dg-icon dg-icon-x"></span>
                                                    <span class="dg-tooltip">
                                                        Limpar Filtro
                                                    </span>
                                                </a>
                                            }
                                        </li>
                                    }

                                    if (Model.mostraControlado)
                                    {
                                        <li>
                                            <a href='@Html.Display("URLControlado")'><span class="dg-icon dg-icon-controlado"></span>Controlados</a>
                                            @if (Model.request.idcontrolado != "" && Model.request.idcontrolado != null)
                                            {

                                                <a href="@Html.Display("URLLimparC")" aria-label="Limpar Filtro" class="dg-categoria-sidebar-limpar dg-tooltip-hover">
                                                    <span class="dg-icon dg-icon-x"></span>
                                                    <span class="dg-tooltip">
                                                        Limpar Filtro
                                                    </span>
                                                </a>
                                            }
                                        </li>
                                    }

                                    if (Model.mostraRefrigerado)
                                    {
                                        <li>
                                            <a href='@Html.Display("URLRefrigerado")'><span class="dg-icon dg-icon-refrigerado"></span>Refrigerado</a>

                                            @if (Model.request.idrefrigerado != "" && Model.request.idrefrigerado != null)
                                            {

                                                <a href="@Html.Display("URLLimparRG")" aria-label="Limpar Filtro" class="dg-categoria-sidebar-limpar dg-tooltip-hover">
                                                    <span class="dg-icon dg-icon-x"></span>
                                                    <span class="dg-tooltip">
                                                        Limpar Filtro
                                                    </span>
                                                </a>
                                            }
                                        </li>
                                    }

                                }


                            </ul>
                        </div>
                    }

                    <div class="dg-categoria-sidebar-limpar-filtros">
                        <a href="@Html.Domain()/@Model.request.URLCategoria/">
                            Limpar Filtro
                        </a>
                    </div>


                </aside>
                @* /Sidebar *@
            }

            <div class="dg-categoria-produtos" tipopg="@tipoPg">

                @if (@tipoPg != "Favoritos")
                {

                    @* Ordenação *@
                    <section class="dg-categoria-ordenacao">
                        <a href="javascript:void(0)" class="dg-categoria-ordenacao-voltar jsAbrirOrdenar">
                            <span class="dg-icon dg-icon-arrow01-left"></span> Voltar
                        </a>

                        <span class="dg-categoria-ordenacao-titulo">
                            Ordenar:
                        </span>

                        <a href="@oModel.UrlBreadcrumb?Ob=6@{
                                                                        @Model.request.URLOb
 }" class="dg-categoria-ordenacao-item @Model.FiltrosCategoria.MaisVendidos">
                            <span class="dg-icon dg-icon-mais-vendidos"></span>
                            <span>Mais <br>vendidos</span>
                        </a>

                        <a href="@oModel.UrlBreadcrumb?Ob=5@{
                                                                        @Model.request.URLOb
 }" class="dg-categoria-ordenacao-item @Model.FiltrosCategoria.MaisRelevantes">
                            <span class="dg-icon dg-icon-estrela"></span>
                            <span>Mais <br>relevantes</span>
                        </a>

                        <a href="@oModel.UrlBreadcrumb?Ob=4@{
                                                                        @Model.request.URLOb
 }" class="dg-categoria-ordenacao-item @Model.FiltrosCategoria.MenorPreco">
                            <span class="dg-icon dg-icon-arrow01-down"></span>
                            <span>Menor <br>preço</span>
                        </a>

                        <a href="@oModel.UrlBreadcrumb?Ob=3@{
                                                                        @Model.request.URLOb
 }" class="dg-categoria-ordenacao-item @Model.FiltrosCategoria.MaiorPreco">
                            <span class="dg-icon dg-icon-arrow01-up"></span>
                            <span>Maior <br>preço</span>
                        </a>


                        <a href="@oModel.UrlBreadcrumb?Ob=7@{
                                                                        @Model.request.URLOb
 }" class="dg-categoria-ordenacao-item @Model.FiltrosCategoria.MaiorDesconto">
                            <span class="dg-icon dg-icon-percent"></span>
                            <span>Maior <br>desconto</span>
                        </a>

                        <div class="dg-categoria-paginacao">
                            <ul class="pageHeader">
                                @{
                                    int xx = 1;

                                    if (Model.Pagina >= 3)
                                    {
                                        if (Model.PageCount > 3)
                                        {

                                            <li>
                                                <a href="?Pagina=@xx@Html.Display("sQS")" class="number-pagination" rel="">1</a>
                                            </li>

                                            if ((Model.PageCount - 2) > xx)
                                            {
                                                <li>
                                                    <span class="dg-categoria-paginacao-etc">...</span>
                                                </li>
                                            }
                                        }

                                    }
                                }
                                @foreach (var ItemPG in Model.Paginacao.Paginas)
                                {


                                    @if (ItemPG.IsSelecionado)
                                    {
                                        <li>
                                            <span>@ItemPG.Pagina</span>
                                        </li>
                                    }
                                    else
                                    {
                                        ULTP = "";
                                        if (Model.PageCount == Model.Paginacao.Paginas.Count())
                                        {
                                            ULTP = "&ULTP=S";

                                        }
                                        <li>
                                            <a href="?Pagina=@ItemPG.Pagina@Html.Display("sQS")@ULTP" class="number-pagination" rel="">@ItemPG.Pagina</a>
                                        </li>

                                    }

                                    xx++;
                                }

                                @{

                                    if (Model.PageCount > 3)
                                    {
                                        if (Model.Pagina > 1) { };

                                        if ((Model.PageCount - 1) > Model.Pagina)
                                        {
                                            <li>
                                                <span class="dg-categoria-paginacao-etc">...</span>
                                            </li>

                                            <li>
                                                <a href="?Pagina=@Model.PageCount@Html.Display("sQS")&ULTP=S" class="number-pagination" rel="">@Model.PageCount</a>
                                            </li>
                                        }
                                    }
                                }

                            </ul>
                        </div>
                    </section>
                    @* /Ordenação *@
                }
                else
                {
                    <div class="dg-categoria-paginacao dg-hide">
                        <ul class="pageHeader">
                            @{
                                int xx = 1;

                                if (Model.Pagina >= 3)
                                {
                                    if (Model.PageCount > 3)
                                    {

                                        <li>
                                            <a href="?Pagina=@xx@Html.Display("sQS")" class="number-pagination" rel="">1</a>
                                        </li>

                                        if ((Model.PageCount - 2) > xx)
                                        {
                                            <li>
                                                <span class="dg-categoria-paginacao-etc">...</span>
                                            </li>
                                        }
                                    }

                                }
                            }
                            @foreach (var ItemPG in Model.Paginacao.Paginas)
                            {


                                @if (ItemPG.IsSelecionado)
                                {
                                    <li>
                                        <span>@ItemPG.Pagina</span>
                                    </li>
                                }
                                else
                                {
                                    ULTP = "";
                                    if (Model.PageCount == Model.Paginacao.Paginas.Count())
                                    {
                                        ULTP = "&ULTP=S";

                                    }
                                    <li>
                                        <a href="?Pagina=@ItemPG.Pagina@Html.Display("sQS")@ULTP" class="number-pagination" rel="">@ItemPG.Pagina</a>
                                    </li>

                                }

                                xx++;
                            }

                            @{

                                if (Model.PageCount > 3)
                                {
                                    if (Model.Pagina > 1) { };

                                    if ((Model.PageCount - 1) > Model.Pagina)
                                    {
                                        <li>
                                            <span class="dg-categoria-paginacao-etc">...</span>
                                        </li>

                                        <li>
                                            <a href="?Pagina=@Model.PageCount@Html.Display("sQS")&ULTP=S" class="number-pagination" rel="">@Model.PageCount</a>
                                        </li>
                                    }
                                }
                            }

                        </ul>
                    </div>
                }

                <main id="main" class="dg-categoria-listagem">


                    <div class="dg-boxproduto-lista @tipoPagColunas">
                        @* Produtos *@
                        @await Html.PartialAsync("_TemplateBoxProduto")
                        <script>ga('ec:setAction', 'detail');</script>
                        @* /Produtos *@

                        <!-- Banner de Categoria -->
                        <!-- Paginação -->
                        <div class="dg-categoria-paginacao dg-categoria-paginacao-footer">
                            <ul class="pageFooter">
                            </ul>

                            <div class="dg-categoria-bners">
                                @await Component.InvokeAsync("BannersCategoria", Model.BannerCategoria)
                            </div>

                        </div>

                </main>
            </div>
        </section>

    </div>

    <script>
        var dataLayer = dataLayer || [];
        dataLayer.push({
            event: 'crto_listingpage',
            crto: {
                products: @Html.Raw(@ViewBag.IdsProdutos)
                                                                    }
        });

    </script>
    @Html.Raw(@ViewBag.retSEOJson)
    @*@Html.Raw(@Model.SEOOrganization)*@
}

@{
    Html.AddCssFileParts(ResourceLocation.Head, "~/assets/css/Categoria.css", false);
    Html.AddScriptParts(ResourceLocation.Footer, "~/assets/js/Categorias.js", false);
}